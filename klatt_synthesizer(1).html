<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sintetizador de Formantes Klatt - Implementaci√≥n Web Completa</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .synthesis-modes {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .mode-button {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .mode-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(79, 172, 254, 0.6);
        }

        .mode-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.6);
        }

        .synthesis-section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .synthesis-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .vowel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-group {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .control-group:hover {
            transform: translateY(-3px);
        }

        .control-group h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1em;
            text-align: center;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 8px;
        }

        .slider-container {
            margin-bottom: 15px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            appearance: none;
            transition: all 0.3s ease;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .play-controls {
            text-align: center;
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .play-button {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.1em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
            font-weight: 600;
        }

        .play-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(40, 167, 69, 0.6);
        }

        .play-button.stop {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }

        .play-button.stop:hover {
            box-shadow: 0 10px 25px rgba(220, 53, 69, 0.6);
        }

        .play-button.download {
            background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%);
            box-shadow: 0 5px 15px rgba(111, 66, 193, 0.4);
        }

        .play-button.download:hover {
            box-shadow: 0 10px 25px rgba(111, 66, 193, 0.6);
        }

        .vowel-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 25px;
        }

        .vowel-button {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa726 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 1.1em;
            min-width: 80px;
        }

        .vowel-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .spectrum-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .spectrum-container h3 {
            text-align: center;
            margin-bottom: 20px;
            color: #495057;
        }

        #spectrum {
            width: 100%;
            height: 250px;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            background: white;
        }

        .vowel-chart {
            background: #e8f5e8;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #28a745;
        }

        .vowel-chart h3 {
            color: #155724;
            margin-bottom: 15px;
            text-align: center;
        }

        .vowel-chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .vowel-info {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .vowel-info .vowel-symbol {
            font-size: 2em;
            font-weight: bold;
            color: #28a745;
            margin-bottom: 5px;
        }

        .vowel-info .vowel-params {
            font-size: 0.9em;
            color: #666;
        }

        .info-section {
            background: #e3f2fd;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border-left: 5px solid #2196f3;
        }

        .info-section h3 {
            color: #1976d2;
            margin-bottom: 15px;
        }

        .info-section p {
            line-height: 1.6;
            color: #424242;
            margin-bottom: 10px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group label {
            cursor: pointer;
            font-weight: 600;
        }

        .status-message {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: 600;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .vowel-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .main-content {
                padding: 20px;
            }

            .synthesis-modes {
                flex-direction: column;
                align-items: center;
            }

            .play-controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Sintetizador de Formantes Klatt</h1>
            <p>Implementaci√≥n web completa del sintetizador cascada/paralelo de Dennis H. Klatt (1980)</p>
        </div>
        
        <div class="main-content">
            <div id="status-message" class="status-message" style="display: none;"></div>
            
            <div class="synthesis-modes">
                <button class="mode-button active" onclick="switchMode('vowels')">S√≠ntesis de Vocales</button>
                <button class="mode-button" onclick="switchMode('advanced')">S√≠ntesis Avanzada</button>
            </div>

            <!-- Secci√≥n de Vocales -->
            <div id="vowels-section" class="synthesis-section active">
                <div class="vowel-chart">
                    <h3>Vocales del Espa√±ol - Espacio F1/F2</h3>
                    <p style="text-align: center; margin-bottom: 15px;">
                        Las vocales del espa√±ol se distinguen principalmente por sus dos primeros formantes (F1 y F2)
                    </p>
                    <div class="vowel-chart-grid">
                        <div class="vowel-info">
                            <div class="vowel-symbol">/a/</div>
                            <div class="vowel-params">F1: 750Hz<br>F2: 1250Hz</div>
                        </div>
                        <div class="vowel-info">
                            <div class="vowel-symbol">/e/</div>
                            <div class="vowel-params">F1: 450Hz<br>F2: 2100Hz</div>
                        </div>
                        <div class="vowel-info">
                            <div class="vowel-symbol">/i/</div>
                            <div class="vowel-params">F1: 300Hz<br>F2: 2300Hz</div>
                        </div>
                        <div class="vowel-info">
                            <div class="vowel-symbol">/o/</div>
                            <div class="vowel-params">F1: 450Hz<br>F2: 900Hz</div>
                        </div>
                        <div class="vowel-info">
                            <div class="vowel-symbol">/u/</div>
                            <div class="vowel-params">F1: 300Hz<br>F2: 700Hz</div>
                        </div>
                    </div>
                </div>

                <div class="vowel-buttons">
                    <button class="vowel-button" onclick="setSpanishVowel('a')">/a/</button>
                    <button class="vowel-button" onclick="setSpanishVowel('e')">/e/</button>
                    <button class="vowel-button" onclick="setSpanishVowel('i')">/i/</button>
                    <button class="vowel-button" onclick="setSpanishVowel('o')">/o/</button>
                    <button class="vowel-button" onclick="setSpanishVowel('u')">/u/</button>
                </div>

                <div class="vowel-grid">
                    <div class="control-group">
                        <h3>Frecuencia Fundamental</h3>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>F0 (Hz)</span>
                                <span id="vowel-f0-value">120</span>
                            </div>
                            <input type="range" id="vowel-f0-slider" class="slider" min="80" max="400" value="120" step="1">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Amplitud</span>
                                <span id="vowel-amp-value">0.3</span>
                            </div>
                            <input type="range" id="vowel-amp-slider" class="slider" min="0" max="1" value="0.3" step="0.01">
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Primer Formante (F1)</h3>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Frecuencia (Hz)</span>
                                <span id="vowel-f1-value">450</span>
                            </div>
                            <input type="range" id="vowel-f1-slider" class="slider" min="200" max="900" value="450" step="5">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Ancho de Banda (Hz)</span>
                                <span id="vowel-b1-value">60</span>
                            </div>
                            <input type="range" id="vowel-b1-slider" class="slider" min="30" max="200" value="60" step="5">
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Segundo Formante (F2)</h3>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Frecuencia (Hz)</span>
                                <span id="vowel-f2-value">1450</span>
                            </div>
                            <input type="range" id="vowel-f2-slider" class="slider" min="500" max="2500" value="1450" step="10">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Ancho de Banda (Hz)</span>
                                <span id="vowel-b2-value">90</span>
                            </div>
                            <input type="range" id="vowel-b2-slider" class="slider" min="40" max="200" value="90" step="5">
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Tercer Formante (F3)</h3>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Frecuencia (Hz)</span>
                                <span id="vowel-f3-value">2450</span>
                            </div>
                            <input type="range" id="vowel-f3-slider" class="slider" min="1300" max="3500" value="2450" step="10">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Ancho de Banda (Hz)</span>
                                <span id="vowel-b3-value">120</span>
                            </div>
                            <input type="range" id="vowel-b3-slider" class="slider" min="50" max="300" value="120" step="5">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n Avanzada -->
            <div id="advanced-section" class="synthesis-section">
                <div class="controls-grid">
                    <!-- Fuentes de Sonido -->
                    <div class="control-group">
                        <h3>Fuentes de Sonido</h3>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>AV - Amplitud Sonoridad (dB)</span>
                                <span id="av-value">60</span>
                            </div>
                            <input type="range" id="av-slider" class="slider" min="0" max="80" value="60" step="1">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>AF - Amplitud Fricaci√≥n (dB)</span>
                                <span id="af-value">0</span>
                            </div>
                            <input type="range" id="af-slider" class="slider" min="0" max="80" value="0" step="1">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>AH - Amplitud Aspiraci√≥n (dB)</span>
                                <span id="ah-value">0</span>
                            </div>
                            <input type="range" id="ah-slider" class="slider" min="0" max="80" value="0" step="1">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>F0 - Frecuencia Fundamental (Hz)</span>
                                <span id="adv-f0-value">120</span>
                            </div>
                            <input type="range" id="adv-f0-slider" class="slider" min="50" max="500" value="120" step="1">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Duraci√≥n (segundos)</span>
                                <span id="duration-value">2.0</span>
                            </div>
                            <input type="range" id="duration-slider" class="slider" min="0.5" max="5.0" value="2.0" step="0.1">
                        </div>
                    </div>

                    <!-- Frecuencias de Formantes -->
                    <div class="control-group">
                        <h3>Frecuencias de Formantes</h3>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>F1 (Hz)</span>
                                <span id="adv-f1-value">450</span>
                            </div>
                            <input type="range" id="adv-f1-slider" class="slider" min="150" max="900" value="450" step="5">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>F2 (Hz)</span>
                                <span id="adv-f2-value">1450</span>
                            </div>
                            <input type="range" id="adv-f2-slider" class="slider" min="500" max="2500" value="1450" step="10">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>F3 (Hz)</span>
                                <span id="adv-f3-value">2450</span>
                            </div>
                            <input type="range" id="adv-f3-slider" class="slider" min="1300" max="3500" value="2450" step="10">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>F4 (Hz)</span>
                                <span id="f4-value">3300</span>
                            </div>
                            <input type="range" id="f4-slider" class="slider" min="2500" max="4500" value="3300" step="10">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>F5 (Hz)</span>
                                <span id="f5-value">3750</span>
                            </div>
                            <input type="range" id="f5-slider" class="slider" min="3500" max="4900" value="3750" step="10">
                        </div>
                    </div>

                    <!-- Anchos de Banda -->
                    <div class="control-group">
                        <h3>Anchos de Banda</h3>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>B1 (Hz)</span>
                                <span id="adv-b1-value">50</span>
                            </div>
                            <input type="range" id="adv-b1-slider" class="slider" min="20" max="200" value="50" step="5">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>B2 (Hz)</span>
                                <span id="adv-b2-value">70</span>
                            </div>
                            <input type="range" id="adv-b2-slider" class="slider" min="20" max="200" value="70" step="5">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>B3 (Hz)</span>
                                <span id="adv-b3-value">110</span>
                            </div>
                            <input type="range" id="adv-b3-slider" class="slider" min="20" max="300" value="110" step="5">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>B4 (Hz)</span>
                                <span id="b4-value">120</span>
                            </div>
                            <input type="range" id="b4-slider" class="slider" min="50" max="300" value="120" step="5">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>B5 (Hz)</span>
                                <span id="b5-value">130</span>
                            </div>
                            <input type="range" id="b5-slider" class="slider" min="50" max="300" value="130" step="5">
                        </div>
                    </div>

                    <!-- Configuraci√≥n del Sistema -->
                    <div class="control-group">
                        <h3>Configuraci√≥n del Sistema</h3>
                        <div class="checkbox-group">
                            <input type="checkbox" id="cascade-mode" checked>
                            <label for="cascade-mode">Modo Cascada (vs Paralelo)</label>
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Ganancia General</span>
                                <span id="gain-value">0.3</span>
                            </div>
                            <input type="range" id="gain-slider" class="slider" min="0" max="1" value="0.3" step="0.01">
                        </div>
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="enable-noise">
                            <label for="enable-noise">Habilitar Fricaci√≥n/Ruido</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="play-controls">
                <button class="play-button" id="play-button" onclick="toggleSound()">‚ñ∂ Reproducir</button>
                <button class="play-button stop" onclick="stopSound()">‚èπ Detener</button>
                <button class="play-button download" onclick="downloadWAV()">üíæ Descargar WAV</button>
            </div>

            <div class="spectrum-container">
                <h3>Visualizaci√≥n del Espectro de Formantes</h3>
                <canvas id="spectrum"></canvas>
            </div>

            <div class="info-section">
                <h3>Sobre el Sintetizador Klatt</h3>
                <p>
                    Esta implementaci√≥n replica fielmente el sintetizador de formantes cascada/paralelo descrito por Dennis H. Klatt en 1980. 
                    El sistema original fue dise√±ado para generar habla sint√©tica de alta calidad usando resonadores de formantes conectados 
                    en configuraciones cascada o paralelo.
                </p>
                <p>
                    <strong>Modo Vocales:</strong> Optimizado para la s√≠ntesis de vocales del espa√±ol, donde F1 y F2 son los par√°metros 
                    principales que distinguen las cinco vocales cardinales.
                </p>
                <p>
                    <strong>Modo Avanzado:</strong> Incluye par√°metros principales del sintetizador original, permitiendo 
                    la s√≠ntesis de diferentes tipos de sonidos del habla.
                </p>
            </div>
        </div>
    </div>

    <script>
        class KlattSynthesizer {
            constructor() {
                this.audioContext = null;
                this.isPlaying = false;
                this.currentMode = 'vowels';
                
                // Cadena de s√≠ntesis
                this.oscillator = null;
                this.noiseSource = null;
                this.filters = [];
                this.gainNode = null;
                
                // Par√°metros del sintetizador
                this.params = {
                    f0: 120,
                    amp: 0.3,
                    f1: 450,
                    b1: 60,
                    f2: 1450,
                    b2: 90,
                    f3: 2450,
                    b3: 120,
                    f4: 3300,
                    b4: 120,
                    f5: 3750,
                    b5: 130,
                    av: 60,
                    af: 0,
                    ah: 0,
                    cascadeMode: true,
                    enableNoise: false,
                    duration: 2.0,
                    gain: 0.3
                };
                
                this.initializeControls();
                this.drawSpectrum();
                this.showMessage('Sintetizador inicializado correctamente', 'success');
            }

            showMessage(text, type = 'success') {
                const messageDiv = document.getElementById('status-message');
                messageDiv.textContent = text;
                messageDiv.className = `status-message ${type}`;
                messageDiv.style.display = 'block';
                
                setTimeout(() => {
                    messageDiv.style.display = 'none';
                }, 3000);
            }

            async initializeAudio() {
                try {
                    if (!this.audioContext) {
                        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        console.log('AudioContext creado:', this.audioContext.state);
                    }
                    
                    if (this.audioContext.state === 'suspended') {
                        await this.audioContext.resume();
                        console.log('AudioContext resumido');
                    }
                    
                    return true;
                } catch (error) {
                    console.error('Error inicializando audio:', error);
                    this.showMessage('Error inicializando audio: ' + error.message, 'error');
                    return false;
                }
            }

            createFormantFilter(frequency, bandwidth) {
                const filter = this.audioContext.createBiquadFilter();
                filter.type = 'bandpass';
                filter.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                
                // Calcular Q basado en la relaci√≥n frecuencia/ancho de banda
                const q = frequency / Math.max(bandwidth, 10);
                filter.Q.setValueAtTime(q, this.audioContext.currentTime);
                
                return filter;
            }

            createRadiationFilter() {
                const filter = this.audioContext.createBiquadFilter();
                filter.type = 'highpass';
                filter.frequency.setValueAtTime(50, this.audioContext.currentTime);
                filter.Q.setValueAtTime(0.7, this.audioContext.currentTime);
                return filter;
            }

            createNoiseBuffer() {
                const bufferSize = this.audioContext.sampleRate * 2; // 2 segundos de ruido
                const buffer = this.audioContext.createBuffer(1, bufferSize, this.audioContext.sampleRate);
                const output = buffer.getChannelData(0);
                
                for (let i = 0; i < bufferSize; i++) {
                    output[i] = Math.random() * 2 - 1;
                }
                
                return buffer;
            }

            async startSound() {
                const success = await this.initializeAudio();
                if (!success) return;
                
                if (this.isPlaying) {
                    this.stopSound();
                }
                
                try {
                    console.log('Iniciando s√≠ntesis con par√°metros:', this.params);
                    
                    // Crear ganancia principal
                    this.gainNode = this.audioContext.createGain();
                    this.gainNode.gain.setValueAtTime(this.params.gain, this.audioContext.currentTime);
                    
                    let sourceNode = null;
                    
                    // Crear fuente de sonoridad (tonal)
                    if (this.params.f0 > 0 && (this.params.av > 0 || this.currentMode === 'vowels')) {
                        this.oscillator = this.audioContext.createOscillator();
                        this.oscillator.type = 'sawtooth';
                        this.oscillator.frequency.setValueAtTime(this.params.f0, this.audioContext.currentTime);
                        
                        // Crear ganancia para el oscilador
                        const oscGain = this.audioContext.createGain();
                        const amplitude = this.currentMode === 'vowels' ? this.params.amp : 
                                        Math.pow(10, (this.params.av - 60) / 20);
                        oscGain.gain.setValueAtTime(amplitude, this.audioContext.currentTime);
                        
                        this.oscillator.connect(oscGain);
                        sourceNode = oscGain;
                        
                        console.log('Fuente tonal creada - F0:', this.params.f0, 'Amplitud:', amplitude);
                    }
                    
                    // Crear fuente de ruido si est√° habilitada
                    if (this.params.enableNoise && this.params.af > 0) {
                        const noiseBuffer = this.createNoiseBuffer();
                        this.noiseSource = this.audioContext.createBufferSource();
                        this.noiseSource.buffer = noiseBuffer;
                        this.noiseSource.loop = true;
                        
                        const noiseGain = this.audioContext.createGain();
                        const noiseAmplitude = Math.pow(10, (this.params.af - 60) / 20);
                        noiseGain.gain.setValueAtTime(noiseAmplitude, this.audioContext.currentTime);
                        
                        this.noiseSource.connect(noiseGain);
                        
                        if (sourceNode) {
                            // Mezclar ruido y tonal
                            const mixer = this.audioContext.createGain();
                            sourceNode.connect(mixer);
                            noiseGain.connect(mixer);
                            sourceNode = mixer;
                        } else {
                            sourceNode = noiseGain;
                        }
                        
                        console.log('Fuente de ruido creada - Amplitud:', noiseAmplitude);
                    }
                    
                    // Si no hay fuente, crear una por defecto
                    if (!sourceNode) {
                        this.oscillator = this.audioContext.createOscillator();
                        this.oscillator.type = 'sawtooth';
                        this.oscillator.frequency.setValueAtTime(this.params.f0 || 120, this.audioContext.currentTime);
                        
                        const defaultGain = this.audioContext.createGain();
                        defaultGain.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                        
                        this.oscillator.connect(defaultGain);
                        sourceNode = defaultGain;
                        
                        console.log('Fuente por defecto creada');
                    }
                    
                    // Crear cadena de filtros de formantes
                    this.filters = [];
                    let currentNode = sourceNode;
                    
                    if (this.params.cascadeMode) {
                        // Modo cascada: F1 -> F2 -> F3 -> ...
                        if (this.params.f1 > 0) {
                            const f1Filter = this.createFormantFilter(this.params.f1, this.params.b1);
                            currentNode.connect(f1Filter);
                            currentNode = f1Filter;
                            this.filters.push(f1Filter);
                            console.log('F1 filtro creado:', this.params.f1, 'Hz, BW:', this.params.b1);
                        }
                        
                        if (this.params.f2 > 0) {
                            const f2Filter = this.createFormantFilter(this.params.f2, this.params.b2);
                            currentNode.connect(f2Filter);
                            currentNode = f2Filter;
                            this.filters.push(f2Filter);
                            console.log('F2 filtro creado:', this.params.f2, 'Hz, BW:', this.params.b2);
                        }
                        
                        if (this.params.f3 > 0) {
                            const f3Filter = this.createFormantFilter(this.params.f3, this.params.b3);
                            currentNode.connect(f3Filter);
                            currentNode = f3Filter;
                            this.filters.push(f3Filter);
                            console.log('F3 filtro creado:', this.params.f3, 'Hz, BW:', this.params.b3);
                        }
                        
                        if (this.currentMode === 'advanced' && this.params.f4 > 0) {
                            const f4Filter = this.createFormantFilter(this.params.f4, this.params.b4);
                            currentNode.connect(f4Filter);
                            currentNode = f4Filter;
                            this.filters.push(f4Filter);
                        }
                        
                        if (this.currentMode === 'advanced' && this.params.f5 > 0) {
                            const f5Filter = this.createFormantFilter(this.params.f5, this.params.b5);
                            currentNode.connect(f5Filter);
                            currentNode = f5Filter;
                            this.filters.push(f5Filter);
                        }
                    }
                    
                    // Filtro de radiaci√≥n
                    const radiationFilter = this.createRadiationFilter();
                    currentNode.connect(radiationFilter);
                    this.filters.push(radiationFilter);
                    
                    // Conectar a la ganancia principal y luego a la salida
                    radiationFilter.connect(this.gainNode);
                    this.gainNode.connect(this.audioContext.destination);
                    
                    // Iniciar las fuentes
                    if (this.oscillator) {
                        this.oscillator.start();
                        console.log('Oscilador iniciado');
                    }
                    
                    if (this.noiseSource) {
                        this.noiseSource.start();
                        console.log('Fuente de ruido iniciada');
                    }
                    
                    this.isPlaying = true;
                    document.getElementById('play-button').textContent = '‚è∏ Pausar';
                    this.showMessage('S√≠ntesis iniciada correctamente', 'success');
                    
                } catch (error) {
                    console.error('Error en startSound:', error);
                    this.showMessage('Error iniciando s√≠ntesis: ' + error.message, 'error');
                }
            }

            stopSound() {
                if (!this.isPlaying) return;
                
                try {
                    if (this.oscillator) {
                        this.oscillator.stop();
                        this.oscillator = null;
                    }
                    
                    if (this.noiseSource) {
                        this.noiseSource.stop();
                        this.noiseSource = null;
                    }
                    
                    this.filters = [];
                    this.gainNode = null;
                    
                    this.isPlaying = false;
                    document.getElementById('play-button').textContent = '‚ñ∂ Reproducir';
                    
                    console.log('S√≠ntesis detenida');
                    
                } catch (error) {
                    console.error('Error deteniendo s√≠ntesis:', error);
                }
            }

            updateParameters() {
                if (this.isPlaying) {
                    const currentTime = this.audioContext.currentTime;
                    
                    try {
                        // Actualizar frecuencia fundamental
                        if (this.oscillator && this.oscillator.frequency) {
                            this.oscillator.frequency.setValueAtTime(this.params.f0, currentTime);
                        }
                        
                        // Actualizar filtros de formantes
                        let filterIndex = 0;
                        
                        if (this.filters[filterIndex] && this.params.f1 > 0) {
                            this.filters[filterIndex].frequency.setValueAtTime(this.params.f1, currentTime);
                            this.filters[filterIndex].Q.setValueAtTime(this.params.f1 / Math.max(this.params.b1, 10), currentTime);
                            filterIndex++;
                        }
                        
                        if (this.filters[filterIndex] && this.params.f2 > 0) {
                            this.filters[filterIndex].frequency.setValueAtTime(this.params.f2, currentTime);
                            this.filters[filterIndex].Q.setValueAtTime(this.params.f2 / Math.max(this.params.b2, 10), currentTime);
                            filterIndex++;
                        }
                        
                        if (this.filters[filterIndex] && this.params.f3 > 0) {
                            this.filters[filterIndex].frequency.setValueAtTime(this.params.f3, currentTime);
                            this.filters[filterIndex].Q.setValueAtTime(this.params.f3 / Math.max(this.params.b3, 10), currentTime);
                            filterIndex++;
                        }
                        
                        // Actualizar ganancia principal
                        if (this.gainNode) {
                            const amplitude = this.currentMode === 'vowels' ? this.params.amp : this.params.gain;
                            this.gainNode.gain.setValueAtTime(amplitude, currentTime);
                        }
                        
                    } catch (error) {
                        console.error('Error actualizando par√°metros:', error);
                    }
                }
                
                this.drawSpectrum();
            }

            async recordWAV() {
                const success = await this.initializeAudio();
                if (!success) return null;
                
                try {
                    const duration = this.params.duration;
                    const sampleRate = 44100;
                    const length = Math.floor(sampleRate * duration);
                    
                    console.log('Iniciando grabaci√≥n WAV - Duraci√≥n:', duration, 'segundos');
                    
                    // Crear contexto offline
                    const offlineContext = new OfflineAudioContext(1, length, sampleRate);
                    
                    // Crear ganancia principal
                    const gainNode = offlineContext.createGain();
                    const amplitude = this.currentMode === 'vowels' ? this.params.amp : this.params.gain;
                    gainNode.gain.setValueAtTime(amplitude, 0);
                    
                    let sourceNode = null;
                    
                    // Crear fuente tonal
                    if (this.params.f0 > 0) {
                        const oscillator = offlineContext.createOscillator();
                        oscillator.type = 'sawtooth';
                        oscillator.frequency.setValueAtTime(this.params.f0, 0);
                        
                        const oscGain = offlineContext.createGain();
                        const oscAmplitude = this.currentMode === 'vowels' ? 1.0 : 
                                           Math.pow(10, (this.params.av - 60) / 20);
                        oscGain.gain.setValueAtTime(oscAmplitude, 0);
                        
                        oscillator.connect(oscGain);
                        sourceNode = oscGain;
                        
                        oscillator.start(0);
                        oscillator.stop(duration);
                    }
                    
                    // Crear fuente de ruido si est√° habilitada
                    if (this.params.enableNoise && this.params.af > 0) {
                        const noiseBuffer = offlineContext.createBuffer(1, length, sampleRate);
                        const output = noiseBuffer.getChannelData(0);
                        
                        for (let i = 0; i < length; i++) {
                            output[i] = Math.random() * 2 - 1;
                        }
                        
                        const noiseSource = offlineContext.createBufferSource();
                        noiseSource.buffer = noiseBuffer;
                        
                        const noiseGain = offlineContext.createGain();
                        const noiseAmplitude = Math.pow(10, (this.params.af - 60) / 20);
                        noiseGain.gain.setValueAtTime(noiseAmplitude, 0);
                        
                        noiseSource.connect(noiseGain);
                        
                        if (sourceNode) {
                            const mixer = offlineContext.createGain();
                            sourceNode.connect(mixer);
                            noiseGain.connect(mixer);
                            sourceNode = mixer;
                        } else {
                            sourceNode = noiseGain;
                        }
                        
                        noiseSource.start(0);
                    }
                    
                    // Si no hay fuente, crear una por defecto
                    if (!sourceNode) {
                        const oscillator = offlineContext.createOscillator();
                        oscillator.type = 'sawtooth';
                        oscillator.frequency.setValueAtTime(this.params.f0 || 120, 0);
                        
                        const defaultGain = offlineContext.createGain();
                        defaultGain.gain.setValueAtTime(0.5, 0);
                        
                        oscillator.connect(defaultGain);
                        sourceNode = defaultGain;
                        
                        oscillator.start(0);
                        oscillator.stop(duration);
                    }
                    
                    // Crear filtros de formantes
                    let currentNode = sourceNode;
                    
                    if (this.params.f1 > 0) {
                        const filter = offlineContext.createBiquadFilter();
                        filter.type = 'bandpass';
                        filter.frequency.setValueAtTime(this.params.f1, 0);
                        filter.Q.setValueAtTime(this.params.f1 / Math.max(this.params.b1, 10), 0);
                        currentNode.connect(filter);
                        currentNode = filter;
                    }
                    
                    if (this.params.f2 > 0) {
                        const filter = offlineContext.createBiquadFilter();
                        filter.type = 'bandpass';
                        filter.frequency.setValueAtTime(this.params.f2, 0);
                        filter.Q.setValueAtTime(this.params.f2 / Math.max(this.params.b2, 10), 0);
                        currentNode.connect(filter);
                        currentNode = filter;
                    }
                    
                    if (this.params.f3 > 0) {
                        const filter = offlineContext.createBiquadFilter();
                        filter.type = 'bandpass';
                        filter.frequency.setValueAtTime(this.params.f3, 0);
                        filter.Q.setValueAtTime(this.params.f3 / Math.max(this.params.b3, 10), 0);
                        currentNode.connect(filter);
                        currentNode = filter;
                    }
                    
                    // Filtro de radiaci√≥n
                    const radiationFilter = offlineContext.createBiquadFilter();
                    radiationFilter.type = 'highpass';
                    radiationFilter.frequency.setValueAtTime(50, 0);
                    radiationFilter.Q.setValueAtTime(0.7, 0);
                    
                    currentNode.connect(radiationFilter);
                    radiationFilter.connect(gainNode);
                    gainNode.connect(offlineContext.destination);
                    
                    // Renderizar
                    const renderedBuffer = await offlineContext.startRendering();
                    console.log('WAV renderizado exitosamente - Duraci√≥n:', renderedBuffer.duration, 'segundos');
                    
                    return renderedBuffer;
                    
                } catch (error) {
                    console.error('Error grabando WAV:', error);
                    this.showMessage('Error grabando WAV: ' + error.message, 'error');
                    return null;
                }
            }

            async downloadWAV() {
                try {
                    this.showMessage('Generando archivo WAV...', 'success');
                    const buffer = await this.recordWAV();
                    
                    if (!buffer) {
                        this.showMessage('Error generando archivo WAV', 'error');
                        return;
                    }
                    
                    const wav = this.audioBufferToWav(buffer);
                    const blob = new Blob([wav], { type: 'audio/wav' });
                    
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `klatt_synthesis_${Date.now()}.wav`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    
                    URL.revokeObjectURL(url);
                    
                    this.showMessage('Archivo WAV descargado exitosamente', 'success');
                    
                } catch (error) {
                    console.error('Error descargando WAV:', error);
                    this.showMessage('Error descargando WAV: ' + error.message, 'error');
                }
            }

            audioBufferToWav(buffer) {
                const length = buffer.length;
                const sampleRate = buffer.sampleRate;
                const arrayBuffer = new ArrayBuffer(44 + length * 2);
                const view = new DataView(arrayBuffer);
                
                // WAV header
                const writeString = (offset, string) => {
                    for (let i = 0; i < string.length; i++) {
                        view.setUint8(offset + i, string.charCodeAt(i));
                    }
                };
                
                writeString(0, 'RIFF');
                view.setUint32(4, 36 + length * 2, true);
                writeString(8, 'WAVE');
                writeString(12, 'fmt ');
                view.setUint32(16, 16, true);
                view.setUint16(20, 1, true);  // PCM
                view.setUint16(22, 1, true);  // Mono
                view.setUint32(24, sampleRate, true);
                view.setUint32(28, sampleRate * 2, true);
                view.setUint16(32, 2, true);
                view.setUint16(34, 16, true);
                writeString(36, 'data');
                view.setUint32(40, length * 2, true);
                
                // Convert samples to 16-bit PCM
                const channelData = buffer.getChannelData(0);
                let offset = 44;
                for (let i = 0; i < length; i++) {
                    const sample = Math.max(-1, Math.min(1, channelData[i]));
                    view.setInt16(offset, sample * 0x7FFF, true);
                    offset += 2;
                }
                
                return arrayBuffer;
            }

            initializeControls() {
                // Controles modo vocales
                this.setupSlider('vowel-f0', 'f0');
                this.setupSlider('vowel-amp', 'amp');
                this.setupSlider('vowel-f1', 'f1');
                this.setupSlider('vowel-b1', 'b1');
                this.setupSlider('vowel-f2', 'f2');
                this.setupSlider('vowel-b2', 'b2');
                this.setupSlider('vowel-f3', 'f3');
                this.setupSlider('vowel-b3', 'b3');
                
                // Controles modo avanzado
                this.setupSlider('av', 'av');
                this.setupSlider('af', 'af');
                this.setupSlider('ah', 'ah');
                this.setupSlider('adv-f0', 'f0');
                this.setupSlider('adv-f1', 'f1');
                this.setupSlider('adv-f2', 'f2');
                this.setupSlider('adv-f3', 'f3');
                this.setupSlider('f4', 'f4');
                this.setupSlider('f5', 'f5');
                this.setupSlider('adv-b1', 'b1');
                this.setupSlider('adv-b2', 'b2');
                this.setupSlider('adv-b3', 'b3');
                this.setupSlider('b4', 'b4');
                this.setupSlider('b5', 'b5');
                this.setupSlider('duration', 'duration');
                this.setupSlider('gain', 'gain');
                
                // Checkboxes
                const cascadeCheckbox = document.getElementById('cascade-mode');
                if (cascadeCheckbox) {
                    cascadeCheckbox.addEventListener('change', (e) => {
                        this.params.cascadeMode = e.target.checked;
                        this.updateParameters();
                    });
                }
                
                const enableNoiseCheckbox = document.getElementById('enable-noise');
                if (enableNoiseCheckbox) {
                    enableNoiseCheckbox.addEventListener('change', (e) => {
                        this.params.enableNoise = e.target.checked;
                        this.updateParameters();
                    });
                }
            }

            setupSlider(sliderId, paramName) {
                const slider = document.getElementById(sliderId + '-slider');
                const valueDisplay = document.getElementById(sliderId + '-value');
                
                if (slider && valueDisplay) {
                    slider.addEventListener('input', (e) => {
                        const value = parseFloat(e.target.value);
                        this.params[paramName] = value;
                        
                        if (paramName === 'amp' || paramName === 'gain' || paramName === 'duration') {
                            valueDisplay.textContent = value.toFixed(2);
                        } else {
                            valueDisplay.textContent = value;
                        }
                        
                        this.updateParameters();
                    });
                }
            }

            drawSpectrum() {
                const canvas = document.getElementById('spectrum');
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
                
                const width = canvas.width;
                const height = canvas.height;
                
                ctx.clearRect(0, 0, width, height);
                
                // Dibujar grid de frecuencias
                ctx.strokeStyle = '#ddd';
                ctx.lineWidth = 1;
                
                for (let freq = 0; freq <= 4000; freq += 500) {
                    const x = (freq / 4000) * width;
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, height);
                    ctx.stroke();
                    
                    ctx.fillStyle = '#666';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(freq + 'Hz', x, height - 5);
                }
                
                // Dibujar respuesta de formantes
                ctx.strokeStyle = '#2196F3';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                const maxFreq = 4000;
                const points = 1000;
                
                for (let i = 0; i < points; i++) {
                    const freq = (i / points) * maxFreq;
                    const x = (freq / maxFreq) * width;
                    
                    let response = 1;
                    
                    // F1 response
                    if (this.params.f1 > 0 && this.params.f1 <= maxFreq) {
                        const q1 = this.params.f1 / Math.max(this.params.b1, 1);
                        const f1Response = 1 / (1 + Math.pow(q1 * (freq - this.params.f1) / this.params.f1, 2));
                        response *= (1 + f1Response * q1);
                    }
                    
                    // F2 response
                    if (this.params.f2 > 0 && this.params.f2 <= maxFreq) {
                        const q2 = this.params.f2 / Math.max(this.params.b2, 1);
                        const f2Response = 1 / (1 + Math.pow(q2 * (freq - this.params.f2) / this.params.f2, 2));
                        response *= (1 + f2Response * q2);
                    }
                    
                    // F3 response
                    if (this.params.f3 > 0 && this.params.f3 <= maxFreq) {
                        const q3 = this.params.f3 / Math.max(this.params.b3, 1);
                        const f3Response = 1 / (1 + Math.pow(q3 * (freq - this.params.f3) / this.params.f3, 2));
                        response *= (1 + f3Response * q3);
                    }
                    
                    const dB = 20 * Math.log10(response + 0.001);
                    const normalizedDB = Math.max(0, Math.min(1, (dB + 40) / 60));
                    const y = height - (normalizedDB * height);
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                
                ctx.stroke();
                
                // Marcadores de formantes
                ctx.strokeStyle = '#E91E63';
                ctx.lineWidth = 2;
                
                const formants = [
                    { freq: this.params.f1, label: 'F1' },
                    { freq: this.params.f2, label: 'F2' },
                    { freq: this.params.f3, label: 'F3' }
                ];
                
                formants.forEach(({ freq, label }) => {
                    if (freq > 0 && freq <= maxFreq) {
                        const x = (freq / maxFreq) * width;
                        ctx.beginPath();
                        ctx.moveTo(x, 0);
                        ctx.lineTo(x, height);
                        ctx.stroke();
                        
                        ctx.fillStyle = '#E91E63';
                        ctx.font = 'bold 14px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText(label, x, 20);
                    }
                });
            }

            setSpanishVowelPreset(vowel) {
                const vowelData = {
                    'a': { f1: 750, b1: 80, f2: 1250, b2: 70, f3: 2600, b3: 120 },
                    'e': { f1: 450, b1: 60, f2: 2100, b2: 90, f3: 2700, b3: 150 },
                    'i': { f1: 300, b1: 40, f2: 2300, b2: 80, f3: 2900, b3: 200 },
                    'o': { f1: 450, b1: 70, f2: 900, b2: 80, f3: 2300, b3: 100 },
                    'u': { f1: 300, b1: 50, f2: 700, b2: 90, f3: 2200, b3: 120 }
                };
                
                const data = vowelData[vowel];
                if (!data) return;
                
                this.params.f1 = data.f1;
                this.params.b1 = data.b1;
                this.params.f2 = data.f2;
                this.params.b2 = data.b2;
                this.params.f3 = data.f3;
                this.params.b3 = data.b3;
                
                // Configuraci√≥n para vocales
                this.params.cascadeMode = true;
                this.params.enableNoise = false;
                
                this.updateAllSliders();
                this.updateParameters();
                
                this.showMessage(`Vocal /${vowel}/ configurada`, 'success');
            }

            updateAllSliders() {
                this.updateSlider('vowel-f0', this.params.f0);
                this.updateSlider('vowel-amp', this.params.amp);
                this.updateSlider('vowel-f1', this.params.f1);
                this.updateSlider('vowel-b1', this.params.b1);
                this.updateSlider('vowel-f2', this.params.f2);
                this.updateSlider('vowel-b2', this.params.b2);
                this.updateSlider('vowel-f3', this.params.f3);
                this.updateSlider('vowel-b3', this.params.b3);
                
                this.updateSlider('adv-f0', this.params.f0);
                this.updateSlider('adv-f1', this.params.f1);
                this.updateSlider('adv-f2', this.params.f2);
                this.updateSlider('adv-f3', this.params.f3);
                this.updateSlider('adv-b1', this.params.b1);
                this.updateSlider('adv-b2', this.params.b2);
                this.updateSlider('adv-b3', this.params.b3);
            }

            updateSlider(sliderId, value) {
                const slider = document.getElementById(sliderId + '-slider');
                const valueDisplay = document.getElementById(sliderId + '-value');
                
                if (slider && valueDisplay) {
                    slider.value = value;
                    if (sliderId.includes('amp') || sliderId.includes('gain') || sliderId.includes('duration')) {
                        valueDisplay.textContent = value.toFixed(2);
                    } else {
                        valueDisplay.textContent = value;
                    }
                }
            }
        }

        // Instancia global del sintetizador
        let synthesizer;

        // Inicializar cuando se carga la p√°gina
        window.addEventListener('load', () => {
            synthesizer = new KlattSynthesizer();
        });

        // Funciones de control
        function switchMode(mode) {
            synthesizer.currentMode = mode;
            
            // Actualizar botones
            document.querySelectorAll('.mode-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Mostrar/ocultar secciones
            document.querySelectorAll('.synthesis-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(mode + '-section').classList.add('active');
            
            synthesizer.showMessage(`Modo ${mode === 'vowels' ? 'Vocales' : 'Avanzado'} activado`, 'success');
        }

        async function toggleSound() {
            if (!synthesizer.isPlaying) {
                await synthesizer.startSound();
            } else {
                synthesizer.stopSound();
            }
        }

        function stopSound() {
            synthesizer.stopSound();
        }

        function setSpanishVowel(vowel) {
            synthesizer.setSpanishVowelPreset(vowel);
        }

        async function downloadWAV() {
            await synthesizer.downloadWAV();
        }

        // Manejar redimensionamiento de ventana
        window.addEventListener('resize', () => {
            if (synthesizer) {
                synthesizer.drawSpectrum();
            }
        });
    </script>
</body>
</html>