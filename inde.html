<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sintetizador de Formantes Klatt - Implementaci√≥n Web Completa</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .synthesis-modes {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .mode-button {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .mode-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(79, 172, 254, 0.6);
        }

        .mode-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.6);
        }

        .synthesis-section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .synthesis-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .vowel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-group {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .control-group:hover {
            transform: translateY(-3px);
        }

        .control-group h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1em;
            text-align: center;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 8px;
        }

        .slider-container {
            margin-bottom: 15px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            appearance: none;
            transition: all 0.3s ease;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .play-controls {
            text-align: center;
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .play-button {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.1em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
            font-weight: 600;
        }

        .play-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(40, 167, 69, 0.6);
        }

        .play-button.stop {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }

        .play-button.stop:hover {
            box-shadow: 0 10px 25px rgba(220, 53, 69, 0.6);
        }

        .play-button.download {
            background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%);
            box-shadow: 0 5px 15px rgba(111, 66, 193, 0.4);
        }

        .play-button.download:hover {
            box-shadow: 0 10px 25px rgba(111, 66, 193, 0.6);
        }

        .vowel-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 25px;
        }

        .vowel-button {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa726 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 1.1em;
            min-width: 80px;
        }

        .vowel-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .spectrum-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .spectrum-container h3 {
            text-align: center;
            margin-bottom: 20px;
            color: #495057;
        }

        #spectrum {
            width: 100%;
            height: 250px;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            background: white;
        }

        .vowel-chart {
            background: #e8f5e8;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #28a745;
        }

        .vowel-chart h3 {
            color: #155724;
            margin-bottom: 15px;
            text-align: center;
        }

        .vowel-chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .vowel-info {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .vowel-info .vowel-symbol {
            font-size: 2em;
            font-weight: bold;
            color: #28a745;
            margin-bottom: 5px;
        }

        .vowel-info .vowel-params {
            font-size: 0.9em;
            color: #666;
        }

        .info-section {
            background: #e3f2fd;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border-left: 5px solid #2196f3;
        }

        .info-section h3 {
            color: #1976d2;
            margin-bottom: 15px;
        }

        .info-section p {
            line-height: 1.6;
            color: #424242;
            margin-bottom: 10px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group label {
            cursor: pointer;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .vowel-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .main-content {
                padding: 20px;
            }

            .synthesis-modes {
                flex-direction: column;
                align-items: center;
            }

            .play-controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Sintetizador de Formantes Klatt</h1>
            <p>Implementaci√≥n web completa del sintetizador cascada/paralelo de Dennis H. Klatt (1980)</p>
        </div>
        
        <div class="main-content">
            <div class="synthesis-modes">
                <button class="mode-button active" onclick="switchMode('vowels')">S√≠ntesis de Vocales</button>
                <button class="mode-button" onclick="switchMode('advanced')">S√≠ntesis Avanzada</button>
            </div>

            <!-- Secci√≥n de Vocales -->
            <div id="vowels-section" class="synthesis-section active">
                <div class="vowel-chart">
                    <h3>Vocales del Espa√±ol - Espacio F1/F2</h3>
                    <p style="text-align: center; margin-bottom: 15px;">
                        Las vocales del espa√±ol se distinguen principalmente por sus dos primeros formantes (F1 y F2)
                    </p>
                    <div class="vowel-chart-grid">
                        <div class="vowel-info">
                            <div class="vowel-symbol">/a/</div>
                            <div class="vowel-params">F1: 750Hz<br>F2: 1250Hz</div>
                        </div>
                        <div class="vowel-info">
                            <div class="vowel-symbol">/e/</div>
                            <div class="vowel-params">F1: 450Hz<br>F2: 2100Hz</div>
                        </div>
                        <div class="vowel-info">
                            <div class="vowel-symbol">/i/</div>
                            <div class="vowel-params">F1: 300Hz<br>F2: 2300Hz</div>
                        </div>
                        <div class="vowel-info">
                            <div class="vowel-symbol">/o/</div>
                            <div class="vowel-params">F1: 450Hz<br>F2: 900Hz</div>
                        </div>
                        <div class="vowel-info">
                            <div class="vowel-symbol">/u/</div>
                            <div class="vowel-params">F1: 300Hz<br>F2: 700Hz</div>
                        </div>
                    </div>
                </div>

                <div class="vowel-buttons">
                    <button class="vowel-button" onclick="setSpanishVowel('a')">/a/</button>
                    <button class="vowel-button" onclick="setSpanishVowel('e')">/e/</button>
                    <button class="vowel-button" onclick="setSpanishVowel('i')">/i/</button>
                    <button class="vowel-button" onclick="setSpanishVowel('o')">/o/</button>
                    <button class="vowel-button" onclick="setSpanishVowel('u')">/u/</button>
                </div>

                <div class="vowel-grid">
                    <div class="control-group">
                        <h3>Frecuencia Fundamental</h3>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>F0 (Hz)</span>
                                <span id="vowel-f0-value">120</span>
                            </div>
                            <input type="range" id="vowel-f0-slider" class="slider" min="80" max="400" value="120" step="1">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Amplitud</span>
                                <span id="vowel-amp-value">0.3</span>
                            </div>
                            <input type="range" id="vowel-amp-slider" class="slider" min="0" max="1" value="0.3" step="0.01">
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Primer Formante (F1)</h3>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Frecuencia (Hz)</span>
                                <span id="vowel-f1-value">450</span>
                            </div>
                            <input type="range" id="vowel-f1-slider" class="slider" min="200" max="900" value="450" step="5">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Ancho de Banda (Hz)</span>
                                <span id="vowel-b1-value">60</span>
                            </div>
                            <input type="range" id="vowel-b1-slider" class="slider" min="30" max="200" value="60" step="5">
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Segundo Formante (F2)</h3>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Frecuencia (Hz)</span>
                                <span id="vowel-f2-value">1450</span>
                            </div>
                            <input type="range" id="vowel-f2-slider" class="slider" min="500" max="2500" value="1450" step="10">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Ancho de Banda (Hz)</span>
                                <span id="vowel-b2-value">90</span>
                            </div>
                            <input type="range" id="vowel-b2-slider" class="slider" min="40" max="200" value="90" step="5">
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Tercer Formante (F3)</h3>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Frecuencia (Hz)</span>
                                <span id="vowel-f3-value">2450</span>
                            </div>
                            <input type="range" id="vowel-f3-slider" class="slider" min="1300" max="3500" value="2450" step="10">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Ancho de Banda (Hz)</span>
                                <span id="vowel-b3-value">120</span>
                            </div>
                            <input type="range" id="vowel-b3-slider" class="slider" min="50" max="300" value="120" step="5">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n Avanzada -->
            <div id="advanced-section" class="synthesis-section">
                <div class="controls-grid">
                    <!-- Fuentes de Sonido -->
                    <div class="control-group">
                        <h3>Fuentes de Sonido</h3>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>AV - Amplitud Sonoridad (dB)</span>
                                <span id="av-value">60</span>
                            </div>
                            <input type="range" id="av-slider" class="slider" min="0" max="80" value="60" step="1">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>AF - Amplitud Fricaci√≥n (dB)</span>
                                <span id="af-value">0</span>
                            </div>
                            <input type="range" id="af-slider" class="slider" min="0" max="80" value="0" step="1">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>AH - Amplitud Aspiraci√≥n (dB)</span>
                                <span id="ah-value">0</span>
                            </div>
                            <input type="range" id="ah-slider" class="slider" min="0" max="80" value="0" step="1">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>AVS - Sonoridad Senoidal (dB)</span>
                                <span id="avs-value">0</span>
                            </div>
                            <input type="range" id="avs-slider" class="slider" min="0" max="80" value="0" step="1">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>F0 - Frecuencia Fundamental (Hz)</span>
                                <span id="adv-f0-value">120</span>
                            </div>
                            <input type="range" id="adv-f0-slider" class="slider" min="0" max="500" value="120" step="1">
                        </div>
                    </div>

                    <!-- Frecuencias de Formantes -->
                    <div class="control-group">
                        <h3>Frecuencias de Formantes</h3>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>F1 (Hz)</span>
                                <span id="adv-f1-value">450</span>
                            </div>
                            <input type="range" id="adv-f1-slider" class="slider" min="150" max="900" value="450" step="5">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>F2 (Hz)</span>
                                <span id="adv-f2-value">1450</span>
                            </div>
                            <input type="range" id="adv-f2-slider" class="slider" min="500" max="2500" value="1450" step="10">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>F3 (Hz)</span>
                                <span id="adv-f3-value">2450</span>
                            </div>
                            <input type="range" id="adv-f3-slider" class="slider" min="1300" max="3500" value="2450" step="10">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>F4 (Hz)</span>
                                <span id="f4-value">3300</span>
                            </div>
                            <input type="range" id="f4-slider" class="slider" min="2500" max="4500" value="3300" step="10">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>F5 (Hz)</span>
                                <span id="f5-value">3750</span>
                            </div>
                            <input type="range" id="f5-slider" class="slider" min="3500" max="4900" value="3750" step="10">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>F6 (Hz)</span>
                                <span id="f6-value">4900</span>
                            </div>
                            <input type="range" id="f6-slider" class="slider" min="4000" max="4999" value="4900" step="10">
                        </div>
                    </div>

                    <!-- Anchos de Banda -->
                    <div class="control-group">
                        <h3>Anchos de Banda</h3>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>B1 (Hz)</span>
                                <span id="adv-b1-value">50</span>
                            </div>
                            <input type="range" id="adv-b1-slider" class="slider" min="40" max="500" value="50" step="5">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>B2 (Hz)</span>
                                <span id="adv-b2-value">70</span>
                            </div>
                            <input type="range" id="adv-b2-slider" class="slider" min="40" max="500" value="70" step="5">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>B3 (Hz)</span>
                                <span id="adv-b3-value">110</span>
                            </div>
                            <input type="range" id="adv-b3-slider" class="slider" min="40" max="500" value="110" step="5">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>B4 (Hz)</span>
                                <span id="b4-value">250</span>
                            </div>
                            <input type="range" id="b4-slider" class="slider" min="100" max="500" value="250" step="5">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>B5 (Hz)</span>
                                <span id="b5-value">200</span>
                            </div>
                            <input type="range" id="b5-slider" class="slider" min="150" max="700" value="200" step="5">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>B6 (Hz)</span>
                                <span id="b6-value">1000</span>
                            </div>
                            <input type="range" id="b6-slider" class="slider" min="200" max="2000" value="1000" step="10">
                        </div>
                    </div>

                    <!-- Amplitudes Paralelas -->
                    <div class="control-group">
                        <h3>Amplitudes Paralelas (dB)</h3>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>A1</span>
                                <span id="a1-value">0</span>
                            </div>
                            <input type="range" id="a1-slider" class="slider" min="0" max="80" value="0" step="1">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>A2</span>
                                <span id="a2-value">0</span>
                            </div>
                            <input type="range" id="a2-slider" class="slider" min="0" max="80" value="0" step="1">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>A3</span>
                                <span id="a3-value">0</span>
                            </div>
                            <input type="range" id="a3-slider" class="slider" min="0" max="80" value="0" step="1">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>A4</span>
                                <span id="a4-value">0</span>
                            </div>
                            <input type="range" id="a4-slider" class="slider" min="0" max="80" value="0" step="1">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>A5</span>
                                <span id="a5-value">0</span>
                            </div>
                            <input type="range" id="a5-slider" class="slider" min="0" max="80" value="0" step="1">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>A6</span>
                                <span id="a6-value">0</span>
                            </div>
                            <input type="range" id="a6-slider" class="slider" min="0" max="80" value="0" step="1">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>AB - Bypass</span>
                                <span id="ab-value">0</span>
                            </div>
                            <input type="range" id="ab-slider" class="slider" min="0" max="80" value="0" step="1">
                        </div>
                    </div>

                    <!-- Par√°metros Nasales -->
                    <div class="control-group">
                        <h3>Par√°metros Nasales</h3>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>FNZ - Frecuencia Cero Nasal (Hz)</span>
                                <span id="fnz-value">250</span>
                            </div>
                            <input type="range" id="fnz-slider" class="slider" min="200" max="700" value="250" step="5">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>FNP - Frecuencia Polo Nasal (Hz)</span>
                                <span id="fnp-value">250</span>
                            </div>
                            <input type="range" id="fnp-slider" class="slider" min="200" max="500" value="250" step="5">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>BNZ - Ancho Banda Cero Nasal (Hz)</span>
                                <span id="bnz-value">100</span>
                            </div>
                            <input type="range" id="bnz-slider" class="slider" min="50" max="500" value="100" step="5">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>BNP - Ancho Banda Polo Nasal (Hz)</span>
                                <span id="bnp-value">100</span>
                            </div>
                            <input type="range" id="bnp-slider" class="slider" min="50" max="500" value="100" step="5">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>AN - Amplitud Formante Nasal (dB)</span>
                                <span id="an-value">0</span>
                            </div>
                            <input type="range" id="an-slider" class="slider" min="0" max="80" value="0" step="1">
                        </div>
                    </div>

                    <!-- Configuraci√≥n del Sistema -->
                    <div class="control-group">
                        <h3>Configuraci√≥n del Sistema</h3>
                        <div class="checkbox-group">
                            <input type="checkbox" id="cascade-mode" checked>
                            <label for="cascade-mode">Modo Cascada (vs Paralelo)</label>
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>GO - Ganancia General (dB)</span>
                                <span id="go-value">47</span>
                            </div>
                            <input type="range" id="go-slider" class="slider" min="0" max="80" value="47" step="1">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Duraci√≥n (segundos)</span>
                                <span id="duration-value">2.0</span>
                            </div>
                            <input type="range" id="duration-slider" class="slider" min="0.5" max="5.0" value="2.0" step="0.1">
                        </div>
                    </div>
                </div>
            </div>

            <div class="play-controls">
                <button class="play-button" id="play-button" onclick="toggleSound()">‚ñ∂ Reproducir</button>
                <button class="play-button stop" onclick="stopSound()">‚èπ Detener</button>
                <button class="play-button download" onclick="downloadWAV()">üíæ Descargar WAV</button>
            </div>

            <div class="spectrum-container">
                <h3>Visualizaci√≥n del Espectro de Formantes</h3>
                <canvas id="spectrum"></canvas>
            </div>

            <div class="info-section">
                <h3>Sobre el Sintetizador Klatt</h3>
                <p>
                    Esta implementaci√≥n replica fielmente el sintetizador de formantes cascada/paralelo descrito por Dennis H. Klatt en 1980. 
                    El sistema original fue dise√±ado para generar habla sint√©tica de alta calidad usando resonadores de formantes conectados 
                    en configuraciones cascada o paralelo.
                </p>
                <p>
                    <strong>Modo Vocales:</strong> Optimizado para la s√≠ntesis de vocales del espa√±ol, donde F1 y F2 son los par√°metros 
                    principales que distinguen las cinco vocales cardinales.
                </p>
                <p>
                    <strong>Modo Avanzado:</strong> Incluye todos los 39 par√°metros de control del sintetizador original, permitiendo 
                    la s√≠ntesis de cualquier sonido del habla, incluyendo consonantes fricativas, nasales y plosivas.
                </p>
            </div>
        </div>
    </div>

    <script>
        class KlattSynthesizer {
            constructor() {
                this.audioContext = null;
                this.oscillators = [];
                this.gainNodes = [];
                this.filters = [];
                this.masterGain = null;
                this.isPlaying = false;
                this.sampleRate = 44100;
                this.recordedBuffer = null;
                this.currentMode = 'vowels';
                
                // Par√°metros del sintetizador (todos los 39 par√°metros originales)
                this.params = {
                    // Fuentes de sonido
                    AV: 60,    // Amplitud sonoridad
                    AF: 0,     // Amplitud fricaci√≥n  
                    AH: 0,     // Amplitud aspiraci√≥n
                    AVS: 0,    // Amplitud sonoridad senoidal
                    F0: 120,   // Frecuencia fundamental
                    
                    // Frecuencias de formantes
                    F1: 450, F2: 1450, F3: 2450, F4: 3300, F5: 3750, F6: 4900,
                    
                    // Anchos de banda
                    B1: 50, B2: 70, B3: 110, B4: 250, B5: 200, B6: 1000,
                    
                    // Amplitudes paralelas
                    A1: 0, A2: 0, A3: 0, A4: 0, A5: 0, A6: 0, AB: 0, AN: 0,
                    
                    // Par√°metros nasales
                    FNZ: 250, FNP: 250, BNZ: 100, BNP: 100,
                    
                    // Sistema
                    SW: 0,     // 0=cascada, 1=paralelo
                    GO: 47,    // Ganancia general
                    duration: 2.0
                };
                
                this.initializeControls();
                this.drawSpectrum();
            }

            async initializeAudio() {
                if (!this.audioContext) {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    if (this.audioContext.state === 'suspended') {
                        await this.audioContext.resume();
                    }
                }
            }

            createGlottalSource() {
                if (this.params.F0 <= 0) return null;
                
                const oscillator = this.audioContext.createOscillator();
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(this.params.F0, this.audioContext.currentTime);
                
                return oscillator;
            }

            createNoiseSource() {
                // Generador de ruido blanco para fricativas
                const bufferSize = 4096;
                const noiseBuffer = this.audioContext.createBuffer(1, bufferSize, this.audioContext.sampleRate);
                const output = noiseBuffer.getChannelData(0);
                
                for (let i = 0; i < bufferSize; i++) {
                    output[i] = Math.random() * 2 - 1;
                }
                
                const noiseSource = this.audioContext.createBufferSource();
                noiseSource.buffer = noiseBuffer;
                noiseSource.loop = true;
                
                return noiseSource;
            }

            createFormantFilter(frequency, bandwidth) {
                const filter = this.audioContext.createBiquadFilter();
                filter.type = 'bandpass';
                filter.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                filter.Q.setValueAtTime(frequency / Math.max(bandwidth, 1), this.audioContext.currentTime);
                
                return filter;
            }

            createRadiationFilter() {
                const filter = this.audioContext.createBiquadFilter();
                filter.type = 'highpass';
                filter.frequency.setValueAtTime(100, this.audioContext.currentTime);
                filter.Q.setValueAtTime(0.7, this.audioContext.currentTime);
                
                return filter;
            }

            dbToLinear(db) {
                return Math.pow(10, db / 20);
            }

            async startSound() {
                await this.initializeAudio();
                
                if (this.isPlaying) return;
                
                const sources = [];
                const allFilters = [];
                
                // Crear fuente glotal si hay sonoridad
                if (this.params.AV > 0 && this.params.F0 > 0) {
                    const glottalSource = this.createGlottalSource();
                    if (glottalSource) {
                        const glottalGain = this.audioContext.createGain();
                        glottalGain.gain.setValueAtTime(
                            this.dbToLinear(this.params.AV - 60), 
                            this.audioContext.currentTime
                        );
                        
                        glottalSource.connect(glottalGain);
                        sources.push({ source: glottalSource, gain: glottalGain, type: 'glottal' });
                    }
                }
                
                // Crear fuente de ruido si hay fricaci√≥n
                if (this.params.AF > 0) {
                    const noiseSource = this.createNoiseSource();
                    const noiseGain = this.audioContext.createGain();
                    noiseGain.gain.setValueAtTime(
                        this.dbToLinear(this.params.AF - 60), 
                        this.audioContext.currentTime
                    );
                    
                    noiseSource.connect(noiseGain);
                    sources.push({ source: noiseSource, gain: noiseGain, type: 'noise' });
                }
                
                // Crear fuente de aspiraci√≥n si es necesario
                if (this.params.AH > 0) {
                    const aspirationSource = this.createNoiseSource();
                    const aspirationGain = this.audioContext.createGain();
                    aspirationGain.gain.setValueAtTime(
                        this.dbToLinear(this.params.AH - 60), 
                        this.audioContext.currentTime
                    );
                    
                    aspirationSource.connect(aspirationGain);
                    sources.push({ source: aspirationSource, gain: aspirationGain, type: 'aspiration' });
                }
                
                // Si no hay fuentes, crear una fuente glotal por defecto
                if (sources.length === 0) {
                    const defaultSource = this.createGlottalSource();
                    if (defaultSource) {
                        const defaultGain = this.audioContext.createGain();
                        defaultGain.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                        defaultSource.connect(defaultGain);
                        sources.push({ source: defaultSource, gain: defaultGain, type: 'default' });
                    }
                }
                
                // Crear cadena de filtros de formantes
                const formantFilters = [];
                
                if (this.params.SW === 0) {
                    // Modo cascada
                    if (this.params.F1 > 0) formantFilters.push(this.createFormantFilter(this.params.F1, this.params.B1));
                    if (this.params.F2 > 0) formantFilters.push(this.createFormantFilter(this.params.F2, this.params.B2));
                    if (this.params.F3 > 0) formantFilters.push(this.createFormantFilter(this.params.F3, this.params.B3));
                    if (this.params.F4 > 0) formantFilters.push(this.createFormantFilter(this.params.F4, this.params.B4));
                    if (this.params.F5 > 0) formantFilters.push(this.createFormantFilter(this.params.F5, this.params.B5));
                } else {
                    // Modo paralelo (simplificado para esta implementaci√≥n)
                    if (this.params.F1 > 0) formantFilters.push(this.createFormantFilter(this.params.F1, this.params.B1));
                    if (this.params.F2 > 0) formantFilters.push(this.createFormantFilter(this.params.F2, this.params.B2));
                    if (this.params.F3 > 0) formantFilters.push(this.createFormantFilter(this.params.F3, this.params.B3));
                }
                
                // Crear filtro de radiaci√≥n
                const radiationFilter = this.createRadiationFilter();
                formantFilters.push(radiationFilter);
                
                // Crear ganancia maestra
                const masterGain = this.audioContext.createGain();
                masterGain.gain.setValueAtTime(
                    this.dbToLinear(this.params.GO - 60), 
                    this.audioContext.currentTime
                );
                
                // Conectar en cascada
                sources.forEach(({ source, gain }) => {
                    let currentNode = gain;
                    
                    formantFilters.forEach(filter => {
                        currentNode.connect(filter);
                        currentNode = filter;
                    });
                    
                    currentNode.connect(masterGain);
                });
                
                masterGain.connect(this.audioContext.destination);
                
                // Almacenar referencias
                this.oscillators = sources.map(s => s.source);
                this.gainNodes = sources.map(s => s.gain);
                this.filters = formantFilters;
                this.masterGain = masterGain;
                
                // Iniciar fuentes
                sources.forEach(({ source }) => {
                    source.start();
                });
                
                this.isPlaying = true;
                document.getElementById('play-button').textContent = '‚è∏ Pausar';
            }

            stopSound() {
                if (!this.isPlaying) return;
                
                this.oscillators.forEach(osc => {
                    try {
                        osc.stop();
                    } catch (e) {
                        // El oscillador podr√≠a ya estar detenido
                    }
                });
                
                this.oscillators = [];
                this.gainNodes = [];
                this.filters = [];
                this.masterGain = null;
                this.isPlaying = false;
                
                document.getElementById('play-button').textContent = '‚ñ∂ Reproducir';
            }

            async recordWAV() {
                await this.initializeAudio();
                
                const duration = this.params.duration;
                const sampleRate = this.audioContext.sampleRate;
                const length = sampleRate * duration;
                
                // Crear un contexto offline para grabaci√≥n
                const offlineContext = new OfflineAudioContext(1, length, sampleRate);
                
                // Recrear la cadena de s√≠ntesis en el contexto offline
                const sources = [];
                
                // Fuente glotal
                if (this.params.AV > 0 && this.params.F0 > 0) {
                    const oscillator = offlineContext.createOscillator();
                    oscillator.type = 'sawtooth';
                    oscillator.frequency.setValueAtTime(this.params.F0, 0);
                    
                    const gain = offlineContext.createGain();
                    gain.gain.setValueAtTime(this.dbToLinear(this.params.AV - 60), 0);
                    
                    oscillator.connect(gain);
                    sources.push({ source: oscillator, gain: gain });
                }
                
                // Fuente de ruido para fricativas
                if (this.params.AF > 0) {
                    const bufferSize = length;
                    const noiseBuffer = offlineContext.createBuffer(1, bufferSize, sampleRate);
                    const output = noiseBuffer.getChannelData(0);
                    
                    for (let i = 0; i < bufferSize; i++) {
                        output[i] = Math.random() * 2 - 1;
                    }
                    
                    const noiseSource = offlineContext.createBufferSource();
                    noiseSource.buffer = noiseBuffer;
                    
                    const noiseGain = offlineContext.createGain();
                    noiseGain.gain.setValueAtTime(this.dbToLinear(this.params.AF - 60), 0);
                    
                    noiseSource.connect(noiseGain);
                    sources.push({ source: noiseSource, gain: noiseGain });
                }
                
                // Si no hay fuentes, crear una por defecto
                if (sources.length === 0) {
                    const oscillator = offlineContext.createOscillator();
                    oscillator.type = 'sawtooth';
                    oscillator.frequency.setValueAtTime(this.params.F0 || 120, 0);
                    
                    const gain = offlineContext.createGain();
                    gain.gain.setValueAtTime(0.1, 0);
                    
                    oscillator.connect(gain);
                    sources.push({ source: oscillator, gain: gain });
                }
                
                // Crear filtros de formantes
                const filters = [];
                if (this.params.F1 > 0) filters.push(this.createFormantFilterOffline(offlineContext, this.params.F1, this.params.B1));
                if (this.params.F2 > 0) filters.push(this.createFormantFilterOffline(offlineContext, this.params.F2, this.params.B2));
                if (this.params.F3 > 0) filters.push(this.createFormantFilterOffline(offlineContext, this.params.F3, this.params.B3));
                
                // Filtro de radiaci√≥n
                const radiationFilter = offlineContext.createBiquadFilter();
                radiationFilter.type = 'highpass';
                radiationFilter.frequency.setValueAtTime(100, 0);
                radiationFilter.Q.setValueAtTime(0.7, 0);
                filters.push(radiationFilter);
                
                // Ganancia maestra
                const masterGain = offlineContext.createGain();
                masterGain.gain.setValueAtTime(this.dbToLinear(this.params.GO - 60), 0);
                
                // Conectar cadena
                sources.forEach(({ source, gain }) => {
                    let currentNode = gain;
                    
                    filters.forEach(filter => {
                        currentNode.connect(filter);
                        currentNode = filter;
                    });
                    
                    currentNode.connect(masterGain);
                });
                
                masterGain.connect(offlineContext.destination);
                
                // Iniciar fuentes
                sources.forEach(({ source }) => {
                    source.start(0);
                    source.stop(duration);
                });
                
                // Renderizar
                const renderedBuffer = await offlineContext.startRendering();
                this.recordedBuffer = renderedBuffer;
                
                return renderedBuffer;
            }

            createFormantFilterOffline(context, frequency, bandwidth) {
                const filter = context.createBiquadFilter();
                filter.type = 'bandpass';
                filter.frequency.setValueAtTime(frequency, 0);
                filter.Q.setValueAtTime(frequency / Math.max(bandwidth, 1), 0);
                return filter;
            }

            async downloadWAV() {
                const buffer = await this.recordWAV();
                const wav = this.audioBufferToWav(buffer);
                const blob = new Blob([wav], { type: 'audio/wav' });
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `klatt_synthesis_${Date.now()}.wav`;
                a.click();
                
                URL.revokeObjectURL(url);
            }

            audioBufferToWav(buffer) {
                const length = buffer.length;
                const sampleRate = buffer.sampleRate;
                const arrayBuffer = new ArrayBuffer(44 + length * 2);
                const view = new DataView(arrayBuffer);
                
                // WAV header
                const writeString = (offset, string) => {
                    for (let i = 0; i < string.length; i++) {
                        view.setUint8(offset + i, string.charCodeAt(i));
                    }
                };
                
                writeString(0, 'RIFF');
                view.setUint32(4, 36 + length * 2, true);
                writeString(8, 'WAVE');
                writeString(12, 'fmt ');
                view.setUint32(16, 16, true);
                view.setUint16(20, 1, true);
                view.setUint16(22, 1, true);
                view.setUint32(24, sampleRate, true);
                view.setUint32(28, sampleRate * 2, true);
                view.setUint16(32, 2, true);
                view.setUint16(34, 16, true);
                writeString(36, 'data');
                view.setUint32(40, length * 2, true);
                
                // Convert float samples to 16-bit PCM
                const channelData = buffer.getChannelData(0);
                let offset = 44;
                for (let i = 0; i < length; i++) {
                    const sample = Math.max(-1, Math.min(1, channelData[i]));
                    view.setInt16(offset, sample * 0x7FFF, true);
                    offset += 2;
                }
                
                return arrayBuffer;
            }

            updateParameters() {
                if (this.isPlaying && this.filters.length >= 3) {
                    const currentTime = this.audioContext.currentTime;
                    
                    // Actualizar frecuencia fundamental
                    this.oscillators.forEach(osc => {
                        if (osc.frequency) {
                            osc.frequency.setValueAtTime(this.params.F0, currentTime);
                        }
                    });
                    
                    // Actualizar filtros de formantes
                    if (this.filters[0]) {
                        this.filters[0].frequency.setValueAtTime(this.params.F1, currentTime);
                        this.filters[0].Q.setValueAtTime(this.params.F1 / Math.max(this.params.B1, 1), currentTime);
                    }
                    
                    if (this.filters[1]) {
                        this.filters[1].frequency.setValueAtTime(this.params.F2, currentTime);
                        this.filters[1].Q.setValueAtTime(this.params.F2 / Math.max(this.params.B2, 1), currentTime);
                    }
                    
                    if (this.filters[2]) {
                        this.filters[2].frequency.setValueAtTime(this.params.F3, currentTime);
                        this.filters[2].Q.setValueAtTime(this.params.F3 / Math.max(this.params.B3, 1), currentTime);
                    }
                    
                    // Actualizar ganancia maestra
                    if (this.masterGain) {
                        this.masterGain.gain.setValueAtTime(this.dbToLinear(this.params.GO - 60), currentTime);
                    }
                }
                
                this.drawSpectrum();
            }

            initializeControls() {
                // Controles del modo vocales
                this.setupSlider('vowel-f0', 'F0');
                this.setupSlider('vowel-amp', 'GO', (val) => val * 80); // Convertir 0-1 a 0-80 dB
                this.setupSlider('vowel-f1', 'F1');
                this.setupSlider('vowel-b1', 'B1');
                this.setupSlider('vowel-f2', 'F2');
                this.setupSlider('vowel-b2', 'B2');
                this.setupSlider('vowel-f3', 'F3');
                this.setupSlider('vowel-b3', 'B3');
                
                // Controles del modo avanzado
                this.setupSlider('av', 'AV');
                this.setupSlider('af', 'AF');
                this.setupSlider('ah', 'AH');
                this.setupSlider('avs', 'AVS');
                this.setupSlider('adv-f0', 'F0');
                this.setupSlider('adv-f1', 'F1');
                this.setupSlider('adv-f2', 'F2');
                this.setupSlider('adv-f3', 'F3');
                this.setupSlider('f4', 'F4');
                this.setupSlider('f5', 'F5');
                this.setupSlider('f6', 'F6');
                this.setupSlider('adv-b1', 'B1');
                this.setupSlider('adv-b2', 'B2');
                this.setupSlider('adv-b3', 'B3');
                this.setupSlider('b4', 'B4');
                this.setupSlider('b5', 'B5');
                this.setupSlider('b6', 'B6');
                this.setupSlider('a1', 'A1');
                this.setupSlider('a2', 'A2');
                this.setupSlider('a3', 'A3');
                this.setupSlider('a4', 'A4');
                this.setupSlider('a5', 'A5');
                this.setupSlider('a6', 'A6');
                this.setupSlider('ab', 'AB');
                this.setupSlider('fnz', 'FNZ');
                this.setupSlider('fnp', 'FNP');
                this.setupSlider('bnz', 'BNZ');
                this.setupSlider('bnp', 'BNP');
                this.setupSlider('an', 'AN');
                this.setupSlider('go', 'GO');
                this.setupSlider('duration', 'duration');
                
                // Checkbox para modo cascada/paralelo
                const cascadeCheckbox = document.getElementById('cascade-mode');
                if (cascadeCheckbox) {
                    cascadeCheckbox.addEventListener('change', (e) => {
                        this.params.SW = e.target.checked ? 0 : 1;
                        this.updateParameters();
                    });
                }
            }

            setupSlider(sliderId, paramName, transform = null) {
                const slider = document.getElementById(sliderId + '-slider');
                const valueDisplay = document.getElementById(sliderId + '-value');
                
                if (slider && valueDisplay) {
                    slider.addEventListener('input', (e) => {
                        let value = parseFloat(e.target.value);
                        if (transform) {
                            value = transform(value);
                        }
                        this.params[paramName] = value;
                        
                        // Actualizar el display
                        if (transform && paramName === 'GO') {
                            valueDisplay.textContent = (parseFloat(e.target.value)).toFixed(2);
                        } else {
                            valueDisplay.textContent = value;
                        }
                        
                        this.updateParameters();
                    });
                }
            }

            drawSpectrum() {
                const canvas = document.getElementById('spectrum');
                const ctx = canvas.getContext('2d');
                
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
                
                const width = canvas.width;
                const height = canvas.height;
                
                ctx.clearRect(0, 0, width, height);
                
                // Dibujar ejes de frecuencia
                ctx.strokeStyle = '#ddd';
                ctx.lineWidth = 1;
                
                for (let freq = 0; freq <= 4000; freq += 500) {
                    const x = (freq / 4000) * width;
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, height);
                    ctx.stroke();
                    
                    ctx.fillStyle = '#666';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(freq + 'Hz', x, height - 5);
                }
                
                // Dibujar respuesta de formantes
                ctx.strokeStyle = '#2196F3';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                const maxFreq = 4000;
                const points = 1000;
                
                for (let i = 0; i < points; i++) {
                    const freq = (i / points) * maxFreq;
                    const x = (freq / maxFreq) * width;
                    
                    let response = 1;
                    
                    // Calcular respuesta combinada de formantes
                    if (this.params.F1 > 0) {
                        const q1 = this.params.F1 / Math.max(this.params.B1, 1);
                        const f1Response = q1 / (1 + Math.pow(q1 * (freq - this.params.F1) / this.params.F1, 2));
                        response *= f1Response;
                    }
                    
                    if (this.params.F2 > 0) {
                        const q2 = this.params.F2 / Math.max(this.params.B2, 1);
                        const f2Response = q2 / (1 + Math.pow(q2 * (freq - this.params.F2) / this.params.F2, 2));
                        response *= f2Response;
                    }
                    
                    if (this.params.F3 > 0) {
                        const q3 = this.params.F3 / Math.max(this.params.B3, 1);
                        const f3Response = q3 / (1 + Math.pow(q3 * (freq - this.params.F3) / this.params.F3, 2));
                        response *= f3Response;
                    }
                    
                    const dB = 20 * Math.log10(response + 0.001);
                    const normalizedDB = Math.max(0, (dB + 60) / 60);
                    const y = height - (normalizedDB * height);
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                
                ctx.stroke();
                
                // Dibujar marcadores de formantes
                ctx.strokeStyle = '#E91E63';
                ctx.lineWidth = 2;
                
                const formants = [
                    { freq: this.params.F1, label: 'F1' },
                    { freq: this.params.F2, label: 'F2' },
                    { freq: this.params.F3, label: 'F3' }
                ];
                
                formants.forEach(({ freq, label }) => {
                    if (freq > 0 && freq <= maxFreq) {
                        const x = (freq / maxFreq) * width;
                        ctx.beginPath();
                        ctx.moveTo(x, 0);
                        ctx.lineTo(x, height);
                        ctx.stroke();
                        
                        ctx.fillStyle = '#E91E63';
                        ctx.font = 'bold 14px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText(label, x, 20);
                    }
                });
            }

            setSpanishVowelPreset(vowel) {
                // Valores optimizados para vocales del espa√±ol
                const vowelData = {
                    'a': { f1: 750, b1: 80, f2: 1250, b2: 70, f3: 2600, b3: 120 },
                    'e': { f1: 450, b1: 60, f2: 2100, b2: 90, f3: 2700, b3: 150 },
                    'i': { f1: 300, b1: 40, f2: 2300, b2: 80, f3: 2900, b3: 200 },
                    'o': { f1: 450, b1: 70, f2: 900, b2: 80, f3: 2300, b3: 100 },
                    'u': { f1: 300, b1: 50, f2: 700, b2: 90, f3: 2200, b3: 120 }
                };
                
                const data = vowelData[vowel];
                if (!data) return;
                
                this.params.F1 = data.f1;
                this.params.B1 = data.b1;
                this.params.F2 = data.f2;
                this.params.B2 = data.b2;
                this.params.F3 = data.f3;
                this.params.B3 = data.b3;
                
                // Configurar para sonoridad clara
                this.params.AV = 60;
                this.params.AF = 0;
                this.params.AH = 0;
                this.params.AVS = 0;
                this.params.SW = 0; // Modo cascada
                
                this.updateAllSliders();
                this.updateParameters();
            }

            updateAllSliders() {
                // Actualizar sliders del modo vocales
                this.updateSlider('vowel-f0', this.params.F0);
                this.updateSlider('vowel-amp', this.params.GO / 80); // Convertir dB a 0-1
                this.updateSlider('vowel-f1', this.params.F1);
                this.updateSlider('vowel-b1', this.params.B1);
                this.updateSlider('vowel-f2', this.params.F2);
                this.updateSlider('vowel-b2', this.params.B2);
                this.updateSlider('vowel-f3', this.params.F3);
                this.updateSlider('vowel-b3', this.params.B3);
                
                // Actualizar sliders del modo avanzado
                this.updateSlider('av', this.params.AV);
                this.updateSlider('af', this.params.AF);
                this.updateSlider('ah', this.params.AH);
                this.updateSlider('avs', this.params.AVS);
                this.updateSlider('adv-f0', this.params.F0);
                this.updateSlider('adv-f1', this.params.F1);
                this.updateSlider('adv-f2', this.params.F2);
                this.updateSlider('adv-f3', this.params.F3);
                this.updateSlider('go', this.params.GO);
            }

            updateSlider(sliderId, value) {
                const slider = document.getElementById(sliderId + '-slider');
                const valueDisplay = document.getElementById(sliderId + '-value');
                
                if (slider && valueDisplay) {
                    slider.value = value;
                    if (sliderId === 'vowel-amp') {
                        valueDisplay.textContent = value.toFixed(2);
                    } else {
                        valueDisplay.textContent = value;
                    }
                }
            }
        }

        // Instancia global del sintetizador
        let synthesizer;

        // Inicializar cuando se carga la p√°gina
        window.addEventListener('load', () => {
            synthesizer = new KlattSynthesizer();
        });

        // Funciones de control
        function switchMode(mode) {
            synthesizer.currentMode = mode;
            
            // Actualizar botones
            document.querySelectorAll('.mode-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Mostrar/ocultar secciones
            document.querySelectorAll('.synthesis-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(mode + '-section').classList.add('active');
        }

        async function toggleSound() {
            if (!synthesizer.isPlaying) {
                await synthesizer.startSound();
            } else {
                synthesizer.stopSound();
            }
        }

        function stopSound() {
            synthesizer.stopSound();
        }

        function setSpanishVowel(vowel) {
            synthesizer.setSpanishVowelPreset(vowel);
        }

        async function downloadWAV() {
            await synthesizer.downloadWAV();
        }

        // Manejar redimensionamiento de ventana
        window.addEventListener('resize', () => {
            if (synthesizer) {
                synthesizer.drawSpectrum();
            }
        });
    </script>
</body>
</html>